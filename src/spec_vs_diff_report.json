{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-09T23:35:16.355Z",
  "summary": "A diff implementa parte do fluxo de autenticação via Internet Identity e adiciona UX de seleção/troca de organização para papéis Firsty, além de introduzir um módulo de migração no backend. Porém, há lacunas claras na listagem/seleção de organizações em modo BACKEND (especialmente para Firsty), e alguns trechos do cliente backend ainda parecem placeholder/insuficientes para cumprir as regras de acesso e os ACs de APIs completas.",
  "missing_requirements": [
    {
      "id": "REQ-2",
      "requirement": "FIRSTY_ADMIN e FIRSTY_CONSULTANT conseguem listar todas as organizações e acessar (leitura/escrita) dados por organização; e OWNER_ADMIN/MEMBER ficam restritos a uma única organização com rejeição clara ao tentar trocar/entrar em outra.",
      "reason": "O cliente backend não implementa listagem de organizações (retorna array vazio) e inclusive comenta que o backend não expõe listOrgs. Isso impede o fluxo de seleção de organização para papéis Firsty e não demonstra suporte de backend para listar todas as organizações.",
      "evidence": [
        "frontend/src/data/api/backendClient.ts (método listOrgs retorna [])",
        "frontend/src/pages/auth/SelectOrganizationPage.tsx (usa client.listOrgs() para seleção de organização)"
      ]
    },
    {
      "id": "REQ-5",
      "requirement": "Firsty roles devem conseguir ver/selecionar qualquer organização no fluxo de seleção; não-Firsty devem ver apenas sua organização; e após seleção, páginas org-scoped operam na org selecionada.",
      "reason": "A tela de seleção depende de client.listOrgs(), mas em BACKEND mode o BackendClient.listOrgs() retorna sempre vazio, inviabilizando na prática a seleção de organizações para papéis Firsty.",
      "evidence": [
        "frontend/src/data/api/backendClient.ts (listOrgs retorna [])",
        "frontend/src/pages/auth/SelectOrganizationPage.tsx (carrega orgs via client.listOrgs())"
      ]
    },
    {
      "id": "REQ-3",
      "requirement": "Todos os métodos que estavam stubados/\"Not implemented in backend\" no backendClient devem ter implementações funcionais no backend (ou serem removidos do frontend se não usados).",
      "reason": "O diff mostra pelo menos uma API essencial (listOrgs) não implementada no cliente backend e com comentário indicando ausência no backend; isso viola o critério de que métodos necessários devem funcionar (especialmente os usados por telas existentes como seleção de organização).",
      "evidence": [
        "frontend/src/data/api/backendClient.ts (listOrgs retorna [] com comentário de ausência no backend)",
        "frontend/src/pages/auth/SelectOrganizationPage.tsx (depende dessa API)"
      ]
    }
  ],
  "hallucinated_features": [],
  "confidence": 0.67,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/app/layout/Topbar.tsx",
    "frontend/src/app/router/PostAuthLanding.tsx",
    "frontend/src/auth/AuthProvider.tsx",
    "frontend/src/auth/InternetIdentityAuthAdapter.ts",
    "frontend/src/data/api/backendClient.ts",
    "frontend/src/data/mock/mockClient.ts",
    "frontend/src/data/mock/seed.ts",
    "frontend/src/org/OrgProvider.tsx",
    "frontend/src/pages/auth/SelectOrganizationPage.tsx",
    "frontend/src/pages/portal/MessagesPage.tsx",
    "frontend/src/types/model.ts",
    "project_state.json"
  ]
}